---
layout: post
title: 情景模式（Profile）
---



## 前言

规则引擎：https://github.com/j-easy/easy-rules



> You can build a simple rules engine yourself. All you need is to create a bunch of objects with conditions and actions, store them in a collection, and run through them to evaluate the conditions and execute the actions.
>
> [Martin Fowler](http://martinfowler.com/) 



## 介绍

情景模式简单理解：

> 什么时候，干什么。

什么时候就是触发条件（condition）

干什么就是动作（actions）



## 新建

新建一条入门实例如下，以JSON格式为例：

```json
[
  {
    "name": "Current pkg",
    "description": "应用切换时，使用Toast显示当前应用的当前应用包名",
    "priority": 2,
    "condition": "frontPkgChanged == true",
    "actions": [
      "ui.showShortToast(activity.getFrontAppPackage());"
    ]
  }
]
```

参数解释：

| 参数名      | 含义                                                         |
| ----------- | ------------------------------------------------------------ |
| name        | 请使用英文，情景模式名字，多个模式不能重复，否则会被覆盖     |
| description | 任意的描述                                                   |
| priority    | 优先级，决定执行顺序                                         |
| condition   | 触发条件，支持mvel表达式，条件可选的基于事实的facts-param请参考下面的章节 |
| actions     | 要执行的动作，支持mvel表达式，可以设置多个，动作可选的handle请参考下面的章节 |



## Fatcs-params

除了提供规则引擎之外，Thanox也会提供常用的事实与参数，用于condition条件判断。

### 应用安装

应用安装成功之后，thanox会发布这个事实，并注入一些参数，你可以使用这些参数做条件判断，或者执行动作时作为参数使用。

| 参数名   | 类型                  | 含义           | 示例                                                         |
| -------- | --------------------- | -------------- | ------------------------------------------------------------ |
| pkgAdded | Boolean（true/false） | 新应用已经安装 | "condition":  "pkgAdded == true"（作为条件判断）             |
| pkgName  | String（字符串）      | 安装的应用包名 | "ui.showShortToast(pkgName);"（作为动作参数）<br />"condition":  "pkgAdded == true"（作为条件判断） |

### 应用切换

前台应用切换时，thanox也会发布这个事实，参数如下。

| 参数名 | 类型 | 含义 | 示例 |
| ------ | ---- | ---- | ---- |
|        |      |      |      |
|        |      |      |      |
|        |      |      |      |
|        |      |      |      |
|        |      |      |      |

